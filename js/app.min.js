function router(e){e.when("/login",{controller:"LoginCtrl",templateUrl:"views/login.html",resolve:{isLogged:["Auth",function(e){return e.$waitForAuth()}]}}).when("/register",{controller:"RegisterCtrl",templateUrl:"views/register.html",resolve:{usernames:["Usernames",function(e){return e.$loaded()}],isLogged:["Auth",function(e){return e.$waitForAuth()}]}}).when("/channels/:channel?",{controller:"ChannelCtrl",templateUrl:"views/chat.html",resolve:{channels:["Channels",function(e){return e.$loaded()}],isLogged:["Auth",function(e){return e.$waitForAuth()}]}}).when("/messages/:user",{controller:"DirectCtrl",templateUrl:"views/chat.html",resolve:{usernames:["Usernames",function(e){return e.$loaded()}],isLogged:["Auth",function(e){return e.$waitForAuth()}]}})}function ChannelCtrl(e,n,t,r,i,o,a,s,c,l,u){return o?t.channel&&i.hasOwnProperty(t.channel)?(e.channels||(n.channels=i),e.users||(n.users=s.all),e.directNotify||(n.directNotify=l.notifications(e.user.$id)),e.channel=t.channel,e.msg={},e.divider=e.user.lastReaded&&e.user.lastReaded[e.channel],c.set(e.channel),e.addMessage=function(){e.msgForm.$invalid||(e.msg.channel=e.channel,e.msg.timestamp=Firebase.ServerValue.TIMESTAMP,e.msg.author={id:e.user.$id,username:e.user.username,avatar:e.user.avatar},e.messages[e.channel].$add(e.msg),e.msg={})},e.remove=function(n){e.messages[e.channel].$remove(n)},e.createChannel=function(){e.newChannelForm.$invalid||(e.channels[e.newChannelName]=!0,e.channels.$save(),e.messages[e.newChannelName]=a(e.newChannelName),e.newChannelName="",e.isNewChannelFormShowed=!1)},e.channels.$ref().on("child_added",function(t){e.messages||(n.messages={}),e.messages[t.key()]=a(t.key())}),e.$watchCollection("messages."+e.channel,function(n){e.user.lastReaded=e.user.lastReaded||{},e.user.lastReaded[e.channel]=n.length&&n[n.length-1].$id,e.user.$save()}),new Firebase(u+"messages/").on("child_changed",function(){e.isTabActive||c.add("* ")}),e.$on("mention",function(){e.isTabActive||c.add("! ")}),e.directNotify.$ref().on("child_added",function(e){c.add("! ")}),void e.$on("tab-active",function(e,n){n&&c.remove()})):r.path("channels/general"):r.path("/login")}function DirectCtrl(e,n,t,r,i,o,a,s,c,l,u){return o?i.hasOwnProperty(t.user)?(e.users||(n.users=s.all),e.channels||(n.channels=a),e.directNotify||(n.directNotify=c.notifications(e.user.$id)),e.msg={},e.directWith={$id:i[t.user],username:t.user},e.messages=c.messages(e.user.$id,e.directWith.$id),l.set(e.directWith.username),l.remove(),c.removeNotifications(e.user.$id,e.directWith.$id),e.addMessage=function(){e.msg.text&&(e.msg.timestamp=Firebase.ServerValue.TIMESTAMP,e.msg.author={id:e.user.$id,username:e.user.username,avatar:e.user.avatar},e.messages.$add(e.msg),c.notify(e.user.$id,e.directWith.$id),e.msg={})},e.remove=function(n){e.messages.$remove(n)},void e.directNotify.$ref().on("child_added",function(e){l.add("! ")})):console.log("user not found"):r.path("/login")}function LoginCtrl(e,n,t,r,i,o){return e.newUser={},o?t.path("/channels"):void(e.login=function(){n.isLoadingHidden=!1,r.$authWithPassword(e.newUser).then(function(e){i.setOnline(e.uid),t.path("/channels")})["catch"](console.error)})}function MainCtrl(e,n,t,r,i,o){r.$onAuth(function(e){e?(n.user=i.getProfile(e.uid),i.setOnline(e.uid),n.isAdmin=i.isAdmin(e.uid)):(n.user=null,t.path("/login"))}),e.lightbox=function(n){e.lightboxSrc=n},e.logout=function(){i.setOffline(e.user.$id),r.$unauth()},e.$on("$routeChangeSuccess",function(){n.isLoadingHidden=!0})}function RegisterCtrl(e,n,t,r,i,o,a){return e.usernames=o,e.newUser={},a?t.path("/channels"):void(e.register=function(){if(!e.RegisterForm.$invalid){if(e.usernames[e.newUser.username])return console.log("this username already exists");n.isLoadingHidden=!1,r.$createUser(e.newUser).then(function(n){return r.$authWithPassword(e.newUser)}).then(function(n){i.setOnline(n.uid);var r=i.getProfile(n.uid);e.usernames[e.newUser.username]=n.uid,e.usernames.$save(),r.username=e.newUser.username,r.avatar=n.password.profileImageURL,r.$save(),i.all.$save(),t.path("/channels")})}})}angular.module("FlameSlackApp",["ngRoute","firebase","ngSanitize"]).constant("FB","https://flame-slack.firebaseio.com/").config(router),router.$inject=["$routeProvider"],angular.module("FlameSlackApp").directive("ngAutoscroll",function(){function e(e,n){function t(){i&&(r.scrollTop=r.scrollHeight)}var r=n[0],i=!0,o=0,a="webkitfullscreenchange mozfullscreenchange fullscreenchange";n.on("DOMSubtreeModified",t),angular.element(document).on(a,function(e){e.target!=document?o=e.target.parentElement.offsetTop:o&&(r.scrollTop=o)}),n.on("scroll",function(){i=r.scrollTop==r.scrollHeight-r.offsetHeight}),e.$on("dividerTop",function(e,n){r.scrollTop=n})}return{link:e}}).directive("ngFocus",function(){function e(e,n){n[0].focus()}return{link:e}}).directive("divider",function(){function e(e,n){angular.element(document.getElementById("chat")).one("DOMSubtreeModified",function(){e.$emit("dividerTop",n[0].offsetTop-150)})}return{link:e}}).directive("ngTabActive",["$window","$rootScope","Title",function(e,n,t){function r(){angular.element(e).on("focus",function(){n.isTabActive=!0,n.$broadcast("tab-active",!0)}).on("blur",function(){n.isTabActive=!1,n.$broadcast("tab-active",!1)})}return{link:r}}]).directive("uniqueUsername",function(){function e(e,n,t,r){r.$validators.uniqueUsername=function(n){return!e.usernames.hasOwnProperty(n)}}return{require:"ngModel",link:e}}).directive("ngEnter",function(){function e(e,n){n.on("input",function(){n[0].offsetHeight<170&&n.css("height",n[0].scrollHeight+2+"px")}),n.on("keydown",function(t){13!=t.keyCode||t.shiftKey||(e.ngEnter(),n.css("height","34px"),t.preventDefault())})}return{scope:{ngEnter:"&"},link:e}}),angular.module("FlameSlackApp").factory("Auth",["$firebaseAuth","FB",function(e,n){return e(new Firebase(n))}]).factory("Users",["$firebaseArray","$firebaseObject","FB",function(e,n,t){var r=new Firebase(t+"users"),i=new Firebase(t+".info/connected"),o=e(r);return{getProfile:function(e){return n(r.child(e))},setOnline:function(t){var o=n(i);online=e(r.child(t+"/online")),o.$watch(function(){o.$value===!0&&online.$add(!0).then(function(){online.$ref().onDisconnect().remove()})}),r.child(t+"/lastOnline").onDisconnect().set(Firebase.ServerValue.TIMESTAMP)},setOffline:function(e){r.child(e+"/online").remove(),r.child(e+"/lastOnline").set(Firebase.ServerValue.TIMESTAMP)},isAdmin:function(e){return n(new Firebase(t).child("admins").child(e))},all:o}}]).factory("Usernames",["$firebaseObject","FB",function(e,n){return e(new Firebase(n+"usernames"))}]).factory("Channels",["$firebaseObject","FB",function(e,n){return e(new Firebase(n+"channels"))}]).factory("Messages",["$firebaseArray","FB",function(e,n){var t=new Firebase(n+"messages");return function(n){return e(t.child(n))}}]).factory("Direct",["$firebaseArray","$firebaseObject","FB",function(e,n,t){return{messages:function(n,r){var i=r>n?n+"/"+r:r+"/"+n;return e(new Firebase(t).child("direct").child(i))},notify:function(e,n){var r=new Firebase(t+"directNotification").child(n).child(e);r.transaction(function(e){return(e||0)+1})},notifications:function(e){return n(new Firebase(t+"directNotification").child(e))},removeNotifications:function(e,n){new Firebase(t+"directNotification").child(e).child(n).remove()}}}]).factory("Title",["$rootScope","FB",function(e,n){var t={set:function(n){e.title=n+" | Flame Slack"},add:function(n){~e.title.indexOf(n)||(e.title=n+e.title)},remove:function(n){n?~e.title.indexOf(n)&&(e.title=(e.title||"").replace(n,"")):e.title=(e.title||"").replace(/[\!\*] /g,"")}};return t}]),angular.module("FlameSlackApp").filter("escape",function(){return function(e){return(e||"").replace(/</g,"&lt;")}}).filter("code",function(){return function(e){return(e||"").replace(/```([^`]+)```/g,"<pre>$1</pre>").replace(/`([^`]+)`/g,"<code>$1</code>")}}).filter("quote",function(){return function(e){return(e||"").replace(/^>([^\n]+)$\n?/gm,"<blockquote>$1</blockquote>")}}).filter("link",["$http",function(e){var n=/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})\/([\/\w\.\-=?]*)*\/?/gi,t=/\.(jpg|jpeg|png|gif)/,r=/(https?:\/\/)(www\.)?youtu\.?be(\.com)?\/(watch\?v=)?([\w\-_]+)(\?t=)?(\w+)?/i,i=/https?:\/\/vimeo\.com\/(\d+)/i;return function(o,a){return(o||"").replace(n,function(n,o){var s='<a href="'+(o?"":"http://")+n+'" target="_blank">'+n+"</a>";if(t.test(n)&&!a.image&&(a.image={src:n}),r.test(n)&&!a.youtube&&(a.youtube={id:n.match(r)[5]}),i.test(n)&&!a.vimeo){var c=n.match(i)[1];a.vimeo={id:c},e.jsonp("https://vimeo.com/api/v2/video/"+c+".json?callback=JSON_CALLBACK").success(function(e){a.vimeo.preview=e[0].thumbnail_large})}return s})}}]).filter("username",["$rootScope",function(e){return function(n){var t=e.users.map(function(e){return e.username});return(n||"").replace(/@(\w+)/,function(n,r){var i=e.user.username==r;return~t.indexOf(r)?(i&&e.$broadcast("mention"),'<a href="#/messages/'+r+'"'+(i?'class="mention"':"")+">"+n+"</a>"):n})}}]).filter("channel",["$rootScope",function(e){return function(n){return(n||"").replace(/#(\w+)/gi,function(n,t){return e.channels.hasOwnProperty(t)?'<a href="#/channels/'+t+'">'+n+"</a>":n})}}]).filter("trustAsHtml",["$sce",function(e){return e.trustAsHtml}]).filter("trustAsResourceUrl",["$sce",function(e){return e.trustAsResourceUrl}]),angular.module("FlameSlackApp").controller("ChannelCtrl",ChannelCtrl),ChannelCtrl.$inject=["$scope","$rootScope","$routeParams","$location","channels","isLogged","Messages","Users","Title","Direct","FB"],angular.module("FlameSlackApp").controller("DirectCtrl",DirectCtrl),DirectCtrl.$inject=["$scope","$rootScope","$routeParams","$location","usernames","isLogged","Channels","Users","Direct","Title","FB"],angular.module("FlameSlackApp").controller("LoginCtrl",LoginCtrl),LoginCtrl.$inject=["$scope","$rootScope","$location","Auth","Users","isLogged"],angular.module("FlameSlackApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["$scope","$rootScope","$location","Auth","Users","Usernames"],angular.module("FlameSlackApp").controller("RegisterCtrl",RegisterCtrl),RegisterCtrl.$inject=["$scope","$rootScope","$location","Auth","Users","usernames","isLogged"];
//# sourceMappingURL=app.min.js.map
