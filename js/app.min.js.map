{"version":3,"sources":["app.js","controllers/channel.ctrl.js","controllers/direct.ctrl.js","controllers/login.ctrl.js","controllers/main.ctrl.js","controllers/messages.ctrl.js","controllers/register.ctrl.js","app.min.js","directives.js","factories.js","filters.js"],"names":["router","$stateProvider","$urlRouterProvider","state","url","controller","templateUrl","resolve","isLogged","Auth","$waitForAuth","usernames","Usernames","$loaded","channels","Channels","otherwise","ChannelCtrl","$rootScope","$scope","$stateParams","$location","Messages","Title","channel","hasOwnProperty","msg","directWith","divider","user","lastReaded","set","addMessage","msgForm","$invalid","timestamp","Firebase","ServerValue","TIMESTAMP","author","id","$id","username","avatar","messages","$add","remove","$remove","$watchCollection","msgs","length","$save","$on","isTabActive","add","path","DirectCtrl","Users","Direct","FB","removeNotifications","text","notify","console","log","LoginCtrl","$state","newUser","go","login","isLoadingHidden","$authWithPassword","then","authData","setOnline","uid","error","MainCtrl","$onAuth","getProfile","isAdmin","MessagesCtrl","users","all","directNotify","notifications","createChannel","newChannelForm","newChannelName","isNewChannelFormShowed","lightbox","src","lightboxSrc","logout","setOffline","$unauth","$ref","on","snap","key","e","active","RegisterCtrl","register","RegisterForm","$createUser","profile","password","profileImageURL","angular","module","constant","config","$inject","directive","link","$el","scrollToBottom","isScrolled","el","scrollTop","scrollHeight","scrolledPosition","fullscreenchange","element","document","target","parentElement","offsetTop","offsetHeight","top","focus","getElementById","one","$emit","$window","$broadcast","$attrs","ngModel","$validators","uniqueUsername","val","require","css","keyCode","shiftKey","ngEnter","preventDefault","scope","factory","$firebaseAuth","$firebaseArray","$firebaseObject","usersRef","connectedRef","child","connected","online","$watch","$value","onDisconnect","msgRef","uid1","uid2","from","to","ref","transaction","title","s","indexOf","replace","filter","$http","linkRegExp","imageRegExp","youtubeRegExp","vimeoRegExp","protocol","html","test","image","youtube","match","vimeo","vimeoId","jsonp","success","data","preview","thumbnail_large","map","currentUser","$emmit","$sce","trustAsHtml","trustAsResourceUrl"],"mappings":"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","file":"app.min.js","sourcesContent":["angular.module('FlameSlackApp', [\r\n    'ui.router', \r\n    'firebase', \r\n    'ngSanitize'  \r\n  ])  \r\n\r\n  .constant('FB', 'https://flame-slack.firebaseio.com/')\r\n\r\n  .config(router)\r\n\r\n\r\nfunction router($stateProvider, $urlRouterProvider) {\r\n  $stateProvider\r\n    .state('login', { \r\n      url: '/login',\r\n      controller: 'LoginCtrl',\r\n      templateUrl: 'views/login.html',\r\n      resolve: {\r\n        isLogged: function(Auth) {\r\n          return Auth.$waitForAuth()\r\n        }\r\n      }\r\n    })\r\n    .state('register', {\r\n      url: '/register',\r\n      controller: 'RegisterCtrl',\r\n      templateUrl: 'views/register.html',\r\n      resolve: {\r\n        usernames: function(Usernames) {\r\n          return Usernames.$loaded()\r\n        },\r\n        isLogged: function(Auth) {\r\n          return Auth.$waitForAuth()\r\n        }\r\n      }\r\n    })\r\n    .state('messages', {\r\n      controller: 'MessagesCtrl',\r\n      templateUrl: 'views/messages.html',\r\n      resolve: {\r\n        isLogged: function(Auth) {\r\n          return Auth.$waitForAuth()\r\n        },\r\n        channels: function(Channels) {\r\n          return Channels.$loaded()\r\n        }\r\n      }\r\n    })\r\n    .state('messages.user', {\r\n      url: '/messages/@:user',\r\n      controller: 'DirectCtrl',\r\n      templateUrl: 'views/chat.html',\r\n      resolve: {\r\n        usernames: function(Usernames) { \r\n          return Usernames.$loaded()\r\n        }\r\n      }\r\n    }) \r\n    .state('messages.channel', {\r\n      url: '/messages/:channel',\r\n      controller: 'ChannelCtrl',\r\n      templateUrl: 'views/chat.html'\r\n    })\r\n\r\n    $urlRouterProvider.otherwise(\"/messages/general\");\r\n}","angular.module('FlameSlackApp')\r\n  .controller('ChannelCtrl', ChannelCtrl)  \r\n\r\n\r\nfunction ChannelCtrl($rootScope, $scope, $stateParams, $location, channels, \r\n                     Messages, Title) {\r\n\r\n  if (!$stateParams.channel || !channels.hasOwnProperty($stateParams.channel))\r\n    return $location.path('channels/general')  \r\n  \r\n  $scope.msg = {}\r\n  $rootScope.directWith = null\r\n  $rootScope.channel = $stateParams.channel\r\n  $scope.divider = $scope.user.lastReaded && \r\n                   $scope.user.lastReaded[$scope.channel]\r\n  \r\n  Title.set($scope.channel)\r\n\r\n  $scope.addMessage = function() {\r\n    if ($scope.msgForm.$invalid) return \r\n\r\n    $scope.msg.channel = $scope.channel\r\n    $scope.msg.timestamp = Firebase.ServerValue.TIMESTAMP\r\n    $scope.msg.author = {\r\n      id: $scope.user.$id,\r\n      username: $scope.user.username,\r\n      avatar: $scope.user.avatar\r\n    }\r\n\r\n    $scope.messages[$scope.channel].$add($scope.msg)\r\n    $scope.msg = {}\r\n  }\r\n\r\n  $scope.remove = function(msg) {\r\n    $scope.messages[$scope.channel].$remove(msg)\r\n  }\r\n\r\n  // last readed messages\r\n  $scope.$watchCollection('messages.' + $scope.channel, function(msgs) {\r\n    $scope.user.lastReaded = $scope.user.lastReaded || {}\r\n    $scope.user.lastReaded[$scope.channel] = msgs.length && \r\n                                             msgs[msgs.length-1].$id\r\n    $scope.user.$save()\r\n  })\r\n\r\n  // mention\r\n  $scope.$on('mention', function() {\r\n    if (!$scope.isTabActive) Title.add('! ')\r\n  })\r\n}","angular.module('FlameSlackApp')\r\n  .controller('DirectCtrl', DirectCtrl)\r\n\r\n\r\nfunction DirectCtrl($scope, $rootScope, $stateParams, $location, usernames,\r\n                    isLogged, Channels, Users, Direct, Title, FB) {\r\n\r\n  if (!usernames.hasOwnProperty($stateParams.user))\r\n    return console.log('user not found')\r\n\r\n  $scope.msg = {}\r\n  $rootScope.channel = null\r\n  $rootScope.directWith = {\r\n    $id: usernames[$stateParams.user],\r\n    username: $stateParams.user\r\n  }\r\n  $scope.messages = Direct.messages($scope.user.$id, $scope.directWith.$id)\r\n\r\n  Title.set($scope.directWith.username)\r\n  Title.remove()\r\n  Direct.removeNotifications($scope.user.$id, $scope.directWith.$id)\r\n\r\n  $scope.addMessage = function() {\r\n    if (!$scope.msg.text) return \r\n\r\n    $scope.msg.timestamp = Firebase.ServerValue.TIMESTAMP\r\n    $scope.msg.author = {\r\n      id: $scope.user.$id,\r\n      username: $scope.user.username,\r\n      avatar: $scope.user.avatar\r\n    }\r\n\r\n    $scope.messages.$add($scope.msg)\r\n    Direct.notify($scope.user.$id, $scope.directWith.$id)\r\n    $scope.msg = {}\r\n  }\r\n\r\n  $scope.remove = function(msg) {\r\n    $scope.messages.$remove(msg)\r\n  }\r\n}","angular.module('FlameSlackApp')\r\n  .controller('LoginCtrl', LoginCtrl)\r\n\r\n\r\nfunction LoginCtrl($scope, $rootScope, $state, Auth, Users, isLogged) {\r\n  $scope.newUser = {}\r\n\r\n  if (isLogged) return $state.go('messages.channel')\r\n\r\n  $scope.login = function() {\r\n    $rootScope.isLoadingHidden = false\r\n\r\n    Auth.$authWithPassword($scope.newUser)\r\n      .then(function(authData) {\r\n        Users.setOnline(authData.uid)\r\n        $state.go('messages.channel')\r\n      })\r\n      .catch(console.error)\r\n  }\r\n}\r\n","angular.module('FlameSlackApp')\r\n  .controller('MainCtrl', MainCtrl)\r\n\r\n\r\nfunction MainCtrl($scope, $rootScope, $state, Auth, Users, Usernames) {\r\n\r\n  Auth.$onAuth(function(authData) {\r\n    if (authData) {\r\n      $rootScope.user = Users.getProfile(authData.uid)\r\n      Users.setOnline(authData.uid)\r\n      $rootScope.isAdmin = Users.isAdmin(authData.uid)\r\n    } else {\r\n      $rootScope.user = null\r\n      $state.go('login')\r\n    }\r\n  })      \r\n\r\n  $scope.$on('$stateChangeSuccess', function() {\r\n    $rootScope.isLoadingHidden = true\r\n  }) \r\n}","angular.module('FlameSlackApp')\r\n  .controller('MessagesCtrl', MessagesCtrl)  \r\n \r\n \r\nfunction MessagesCtrl($rootScope, $scope, $stateParams, $location, Auth,\r\n                      isLogged, Messages, Users, Title, Direct, FB, channels) {\r\n\r\n  if (!isLogged)\r\n    return $location.path('/login')\r\n\r\n  $rootScope.users = Users.all\r\n  $rootScope.channels = channels\r\n  $scope.directNotify = Direct.notifications($scope.user.$id)    \r\n\r\n  $scope.createChannel = function() {\r\n    if ($scope.newChannelForm.$invalid) return\r\n      \r\n    $scope.channels[$scope.newChannelName] = true\r\n    $scope.channels.$save()\r\n    $scope.messages[$scope.newChannelName] = Messages($scope.newChannelName)\r\n    $scope.newChannelName = ''\r\n    $scope.isNewChannelFormShowed = false\r\n  }\r\n  \r\n  $scope.lightbox = function(src) {\r\n    $scope.lightboxSrc = src\r\n  }\r\n\r\n  $scope.logout = function() {\r\n    Users.setOffline($scope.user.$id)\r\n    Auth.$unauth()\r\n  }   \r\n\r\n  // load messages\r\n  $scope.channels.$ref().on('child_added', function(snap) {\r\n    if (!$scope.messages) $rootScope.messages = {}\r\n    $scope.messages[snap.key()] = Messages(snap.key())\r\n  }) \r\n\r\n  // new message\r\n  new Firebase(FB + 'messages/').on('child_changed', function() {\r\n    if (!$scope.isTabActive) Title.add('* ')\r\n  }) \r\n\r\n  $scope.directNotify.$ref().on('child_added', function(snap) {\r\n    Title.add('! ')\r\n  })\r\n\r\n  $scope.$on('tab-active', function(e, active) {\r\n    if (active) Title.remove()\r\n  })  \r\n\r\n  $scope.directNotify.$ref().on('child_added', function(snap) {\r\n    Title.add('! ')\r\n  })   \r\n}","angular.module('FlameSlackApp')\r\n  .controller('RegisterCtrl', RegisterCtrl)\r\n\r\n\r\nfunction RegisterCtrl($scope, $rootScope, $state, Auth, Users, \r\n                      usernames, isLogged) {\r\n  $scope.usernames = usernames\r\n  $scope.newUser = {}\r\n  \r\n  if (isLogged) return $state.go('messages.channel')\r\n\r\n  $scope.register = function() {\r\n    if ($scope.RegisterForm.$invalid) return\r\n    if ($scope.usernames[$scope.newUser.username])\r\n      return console.log('this username already exists')\r\n\r\n    $rootScope.isLoadingHidden = false\r\n\r\n    Auth.$createUser($scope.newUser)\r\n      .then(function(authData) {\r\n        return Auth.$authWithPassword($scope.newUser)\r\n      })\r\n      .then(function(authData) {\r\n        Users.setOnline(authData.uid)\r\n        var profile = Users.getProfile(authData.uid)\r\n\r\n        $scope.usernames[$scope.newUser.username] = authData.uid\r\n        $scope.usernames.$save()\r\n        profile.username = $scope.newUser.username\r\n        profile.avatar = authData.password.profileImageURL\r\n        profile.$save()\r\n        Users.all.$save()\r\n        $state.go('messages.channel')\r\n      })\r\n  }\r\n}",null,"angular.module('FlameSlackApp')\r\n\r\n  .directive('ngAutoscroll', function() {\r\n    function link($scope, $el) {\r\n      var el = $el[0],\r\n          isScrolled = true,\r\n          scrolledPosition = 0,\r\n          fullscreenchange = 'webkitfullscreenchange mozfullscreenchange fullscreenchange'\r\n\r\n      function scrollToBottom() {\r\n        if (isScrolled) el.scrollTop = el.scrollHeight\r\n      }\r\n\r\n      $el.on('DOMSubtreeModified', scrollToBottom)\r\n\r\n      // chrome scroll fix\r\n      angular.element(document).on(fullscreenchange, function(e) {\r\n        if (e.target != document) {\r\n          scrolledPosition = e.target.parentElement.offsetTop\r\n        } else if (scrolledPosition) {\r\n          el.scrollTop = scrolledPosition\r\n        }\r\n      })\r\n\r\n      $el.on('scroll', function() {\r\n        isScrolled = el.scrollTop == el.scrollHeight - el.offsetHeight\r\n      })\r\n\r\n      $scope.$on('dividerTop', function(e, top) {\r\n        el.scrollTop = top\r\n      })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngFocus', function() {\r\n    function link($scope, $el) {\r\n      $el[0].focus()\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('divider', function() {\r\n    function link($scope, $el) {\r\n      angular.element(document.getElementById('chat'))\r\n        .one('DOMSubtreeModified', function() {\r\n          $scope.$emit('dividerTop', $el[0].offsetTop - 150)\r\n        })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngTabActive', function($window, $rootScope,  Title) {\r\n    function link() {\r\n      angular.element($window)\r\n        .on('focus', function() {\r\n          $rootScope.isTabActive = true\r\n          $rootScope.$broadcast('tab-active', true)\r\n        })\r\n        .on('blur', function() {\r\n          $rootScope.isTabActive = false\r\n          $rootScope.$broadcast('tab-active', false)\r\n        })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('uniqueUsername', function() {\r\n    function link($scope, $el, $attrs, ngModel) {\r\n      ngModel.$validators.uniqueUsername = function(val) {\r\n        return !$scope.usernames.hasOwnProperty(val)\r\n      }\r\n    }\r\n\r\n    return {\r\n      require: 'ngModel',\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngEnter', function() {\r\n    function link($scope, $el) {\r\n      $el.on('input', function() {\r\n        if ($el[0].offsetHeight < 170) \r\n          $el.css('height', $el[0].scrollHeight + 2 + 'px')\r\n      })\r\n\r\n      $el.on('keydown', function(e) {\r\n        if (e.keyCode == 13 && !e.shiftKey) {\r\n          $scope.ngEnter()\r\n          $el.css('height', '34px')\r\n          e.preventDefault()\r\n        }\r\n      })\r\n    }\r\n\r\n    return {\r\n      scope: {\r\n        ngEnter: '&'\r\n      },\r\n      link: link\r\n    }\r\n  })","angular.module('FlameSlackApp')\r\n\r\n  .factory('Auth', function($firebaseAuth, FB) {\r\n    return $firebaseAuth(new Firebase(FB))\r\n  })\r\n\r\n  .factory('Users', function($firebaseArray, $firebaseObject, FB) {\r\n    var usersRef = new Firebase(FB + 'users'),\r\n        connectedRef = new Firebase(FB + '.info/connected'),\r\n        users = $firebaseArray(usersRef)\r\n\r\n    return {\r\n      getProfile: function(uid) {\r\n        return $firebaseObject(usersRef.child(uid))\r\n      },\r\n      setOnline: function(uid) {\r\n        var connected = $firebaseObject(connectedRef)\r\n            online = $firebaseArray(usersRef.child(uid + '/online'))\r\n\r\n        connected.$watch(function() {\r\n          if (connected.$value === true) {\r\n            online.$add(true).then(function() {\r\n              online.$ref().onDisconnect().remove()\r\n            })\r\n          }\r\n        })\r\n\r\n        usersRef.child(uid + '/lastOnline')\r\n          .onDisconnect().set(Firebase.ServerValue.TIMESTAMP)\r\n      },\r\n      setOffline: function(uid) {\r\n        usersRef.child(uid + '/online').remove()\r\n        usersRef.child(uid + '/lastOnline').set(Firebase.ServerValue.TIMESTAMP)\r\n      },\r\n      isAdmin: function(uid) {\r\n        return $firebaseObject(new Firebase(FB).child('admins').child(uid))\r\n      },\r\n      all: users\r\n    }\r\n  })\r\n\r\n  .factory('Usernames', function($firebaseObject, FB) {\r\n    return $firebaseObject(new Firebase(FB + 'usernames'))\r\n  })\r\n\r\n  .factory('Channels', function($firebaseObject, FB) {\r\n    return $firebaseObject(new Firebase(FB + 'channels'))\r\n  })\r\n\r\n  .factory('Messages', function($firebaseArray, FB) {\r\n    var msgRef = new Firebase(FB + 'messages')\r\n\r\n    return function(channel) {\r\n      return $firebaseArray(msgRef.child(channel))\r\n    }\r\n  })\r\n\r\n  .factory('Direct', function($firebaseArray, $firebaseObject, FB) {\r\n    return {\r\n      messages: function(uid1, uid2) {\r\n        var path = uid1 < uid2 ? uid1 + '/' + uid2 : uid2 + '/' + uid1\r\n        return $firebaseArray(new Firebase(FB).child('direct').child(path))\r\n      },\r\n      notify: function(from, to) {\r\n        var ref = new Firebase(FB + 'directNotification').child(to).child(from)\r\n        ref.transaction(function(val) {\r\n          return (val || 0) + 1\r\n        })\r\n      },\r\n      notifications: function(uid) {\r\n        return $firebaseObject(new Firebase(FB + 'directNotification').child(uid))\r\n      },\r\n      removeNotifications: function(to, from) {\r\n        new Firebase(FB + 'directNotification').child(to).child(from).remove()\r\n      }\r\n    }\r\n  })\r\n\r\n  .factory('Title', function($rootScope, FB) {\r\n    var Title = {\r\n      set: function(channel) {\r\n        $rootScope.title = channel + ' | Flame Slack'\r\n      },\r\n      add: function(s) {\r\n        if (!~$rootScope.title.indexOf(s))\r\n          $rootScope.title = s + $rootScope.title\r\n      },\r\n      remove: function(s) {\r\n        if (!s)\r\n          $rootScope.title = ($rootScope.title||'').replace(/[\\!\\*] /g, '')\r\n        else if (~$rootScope.title.indexOf(s))\r\n          $rootScope.title = ($rootScope.title||'').replace(s, '')\r\n      }\r\n    }\r\n\r\n    return Title\r\n  })","angular.module('FlameSlackApp')\r\n\r\n  .filter('escape', function() {\r\n    return function(text) {\r\n      return (text||'').replace(/</g, '&lt;')\r\n    }\r\n  })\r\n\r\n  .filter('code', function() {\r\n    return function(text) {\r\n      return (text||'').replace(/```([^`]+)```/g, '<pre>$1</pre>')\r\n                       .replace(/`([^`]+)`/g, '<code>$1</code>')\r\n    }\r\n  })\r\n\r\n  .filter('quote', function() {\r\n    return function(text) {\r\n      return (text||'').replace(/^>([^\\n]+)$\\n?/gm, '<blockquote>$1</blockquote>')\r\n    }\r\n  })\r\n\r\n  .filter('link', function($http) {\r\n    var linkRegExp = /(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})\\/([\\/\\w\\.\\-=?]*)*\\/?/gi\r\n    var imageRegExp = /\\.(jpg|jpeg|png|gif)/\r\n    var youtubeRegExp = /(https?:\\/\\/)(www\\.)?youtu\\.?be(\\.com)?\\/(watch\\?v=)?([\\w\\-_]+)(\\?t=)?(\\w+)?/i\r\n    var vimeoRegExp = /https?:\\/\\/vimeo\\.com\\/(\\d+)/i\r\n\r\n\r\n    return function(text, scope) {\r\n      return (text||'').replace(linkRegExp, function(link, protocol) {\r\n        var html = '<a href=\"' + (protocol ? '' : 'http://') + \r\n                    link + '\" target=\"_blank\">' + link + '</a>'\r\n\r\n        if (imageRegExp.test(link) && !scope.image) \r\n          scope.image = { src: link }\r\n\r\n        if (youtubeRegExp.test(link) && !scope.youtube) \r\n          scope.youtube = { id: link.match(youtubeRegExp)[5] }\r\n\r\n        if (vimeoRegExp.test(link) && !scope.vimeo) {\r\n          var vimeoId = link.match(vimeoRegExp)[1]\r\n          scope.vimeo = { id: vimeoId }\r\n\r\n          $http\r\n            .jsonp('https://vimeo.com/api/v2/video/' + \r\n                    vimeoId + '.json?callback=JSON_CALLBACK')\r\n            .success(function(data) {\r\n              scope.vimeo.preview = data[0].thumbnail_large\r\n            })\r\n        }\r\n\r\n        return html\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('username', function() { \r\n    return function(text, scope) {\r\n      var users = scope.users.map(function(user) {return user.username})\r\n\r\n      return (text||'').replace(/@(\\w+)/, function(match, username) {\r\n        var currentUser = scope.user.username == username\r\n\r\n        if (~users.indexOf(username)) {\r\n          if (currentUser) scope.$emmit('mention')\r\n\r\n          return '<a href=\"#/messages/' + username + '\"' +\r\n                 (currentUser ? 'class=\"mention\"' : '') +\r\n                 '>' + match + '</a>'\r\n        } else {\r\n          return match\r\n        }\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('channel', function() {\r\n    return function(text, scope) {\r\n      return (text||'').replace(/#(\\w+)/gi, function(match, channel) {\r\n        if (scope.channels.hasOwnProperty(channel))\r\n          return '<a href=\"#/channels/' + channel + '\">' + match + '</a>'\r\n        else\r\n          return match\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('trustAsHtml', function($sce){\r\n    return $sce.trustAsHtml\r\n  })\r\n\r\n  .filter('trustAsResourceUrl', function($sce) {\r\n    return $sce.trustAsResourceUrl\r\n  })\r\n\r\n\r\n"],"sourceRoot":"/source/"}