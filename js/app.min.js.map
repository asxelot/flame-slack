{"version":3,"sources":["controllers/channel.ctrl.js","controllers/direct.ctrl.js","controllers/login.ctrl.js","controllers/main.ctrl.js","controllers/register.ctrl.js","app.js","directives.js","factories.js","filters.js","app.min.js"],"names":["ChannelCtrl","$scope","$rootScope","$routeParams","$location","channels","isLogged","Messages","Users","Title","FB","channel","hasOwnProperty","users","all","msg","divider","user","lastReaded","set","$ref","on","snap","messages","key","$watchCollection","msgs","length","$id","$save","Firebase","isTabActive","add","$on","e","active","remove","addMessage","text","timestamp","ServerValue","TIMESTAMP","author","id","username","avatar","$add","$remove","createChannel","newChannelForm","$invalid","newChannelName","isNewChannelFormShowed","path","DirectCtrl","usernames","Channels","Direct","console","log","directNotify","notifications","directWith","removeNotifications","notify","LoginCtrl","Auth","newUser","login","$authWithPassword","then","authData","setOnline","uid","error","MainCtrl","Usernames","$onAuth","getProfile","isAdmin","lightbox","src","lightboxSrc","logout","setOffline","$unauth","RegisterCtrl","register","RegisterForm","$createUser","profile","password","profileImageURL","angular","module","constant","config","$routeProvider","when","controller","templateUrl","resolve","$waitForAuth","$loaded","directive","link","$el","scrollToBottom","isScrolled","el","scrollTop","scrollHeight","scrolledPosition","fullscreenchange","element","document","target","parentElement","offsetTop","offsetHeight","top","focus","getElementById","one","$emit","$window","$broadcast","$attrs","ngModel","$validators","uniqueUsername","val","require","css","keyCode","shiftKey","ngEnter","preventDefault","scope","factory","$firebaseAuth","$firebaseArray","$firebaseObject","usersRef","connectedRef","child","connected","online","$watch","$value","onDisconnect","msgRef","uid1","uid2","from","to","ref","transaction","title","s","indexOf","replace","filter","$http","linkRegExp","imageRegExp","youtubeRegExp","vimeoRegExp","protocol","html","test","image","youtube","match","vimeo","vimeoId","jsonp","success","data","preview","thumbnail_large","map","currentUser","$sce","trustAsHtml","trustAsResourceUrl","$inject"],"mappings":"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","file":"app.min.js","sourcesContent":["angular.module('FlameSlackApp')\r\n  .controller('ChannelCtrl', ChannelCtrl)  \r\n\r\n\r\nfunction ChannelCtrl($scope, $rootScope, $routeParams, $location, channels, \r\n                      isLogged, Messages, Users, Title, FB) {\r\n  if (!isLogged) \r\n    return $location.path('/login')\r\n\r\n  if (!$routeParams.channel || !channels.hasOwnProperty($routeParams.channel))\r\n    return $location.path('channels/general')  \r\n\r\n  if (!$scope.channels) $rootScope.channels = channels\r\n  if (!$scope.users) $rootScope.users = Users.all\r\n\r\n  $scope.channel = $routeParams.channel\r\n  $scope.msg = {}\r\n  $scope.divider = $scope.user.lastReaded && \r\n                   $scope.user.lastReaded[$scope.channel]\r\n  \r\n  Title.set($scope.channel)\r\n\r\n  // load messages\r\n  $scope.channels.$ref().on('child_added', function(snap) {\r\n    if (!$scope.messages) $rootScope.messages = {}\r\n    $scope.messages[snap.key()] = Messages(snap.key())\r\n  }) \r\n\r\n  // last readed messages\r\n  $scope.$watchCollection('messages.' + $scope.channel, function(msgs) {\r\n    $scope.user.lastReaded = $scope.user.lastReaded || {}\r\n    $scope.user.lastReaded[$scope.channel] = msgs.length && \r\n                                             msgs[msgs.length-1].$id\r\n    $scope.user.$save()\r\n  })\r\n\r\n  // new message\r\n  new Firebase(FB + 'messages/').on('child_changed', function() {\r\n    if (!$scope.isTabActive) Title.add('* ')\r\n  })\r\n\r\n  // mention\r\n  $scope.$on('mention', function() {\r\n    if (!$scope.isTabActive) Title.add('! ')\r\n  })\r\n\r\n  $scope.$on('tab-active', function(e, active) {\r\n    if (active) Title.remove()\r\n  })\r\n\r\n  $scope.addMessage = function() {\r\n    if (!$scope.msg.text) return \r\n\r\n    $scope.msg.channel = $scope.channel\r\n    $scope.msg.timestamp = Firebase.ServerValue.TIMESTAMP\r\n    $scope.msg.author = {\r\n      id: $scope.user.$id,\r\n      username: $scope.user.username,\r\n      avatar: $scope.user.avatar\r\n    }\r\n\r\n    $scope.messages[$scope.channel].$add($scope.msg)\r\n    $scope.msg = {}\r\n  }\r\n\r\n  $scope.remove = function(msg) {\r\n    $scope.messages[$scope.channel].$remove(msg)\r\n  }\r\n\r\n  $scope.createChannel = function() {\r\n    if ($scope.newChannelForm.$invalid) return\r\n      \r\n    $scope.channels[$scope.newChannelName] = true\r\n    $scope.channels.$save()\r\n    $scope.messages[$scope.newChannelName] = Messages($scope.newChannelName)\r\n    $scope.newChannelName = ''\r\n    $scope.isNewChannelFormShowed = false\r\n  }\r\n}","angular.module('FlameSlackApp')\r\n  .controller('DirectCtrl', DirectCtrl)\r\n\r\n\r\nfunction DirectCtrl($scope, $rootScope, $routeParams, $location, usernames,\r\n                    isLogged, Channels, Users, Direct, FB) {\r\n  if (!isLogged) \r\n    return $location.path('/login')\r\n\r\n  if (!usernames.hasOwnProperty($routeParams.user))\r\n    console.log('user not found')\r\n\r\n  if (!$scope.users) $rootScope.users = Users.all\r\n  if (!$scope.channels) $rootScope.channels = Channels\r\n  if (!$scope.directNotify) \r\n    $rootScope.directNotify = Direct.notifications($scope.user.$id)\r\n\r\n  $scope.msg = {}\r\n  $scope.directWith = {\r\n    $id: usernames[$routeParams.user],\r\n    username: $routeParams.user\r\n  }\r\n  $scope.messages = Direct.messages($scope.user.$id, $scope.directWith.$id)\r\n\r\n  Direct.removeNotifications($scope.user.$id, $scope.directWith.$id)\r\n\r\n  $scope.addMessage = function() {\r\n    if (!$scope.msg.text) return \r\n\r\n    $scope.msg.timestamp = Firebase.ServerValue.TIMESTAMP\r\n    $scope.msg.author = {\r\n      id: $scope.user.$id,\r\n      username: $scope.user.username,\r\n      avatar: $scope.user.avatar\r\n    }\r\n\r\n    $scope.messages.$add($scope.msg)\r\n    Direct.notify($scope.user.$id, $scope.directWith.$id)\r\n    $scope.msg = {}\r\n  }\r\n}","angular.module('FlameSlackApp')\r\n  .controller('LoginCtrl', LoginCtrl)\r\n\r\n\r\nfunction LoginCtrl($scope, $location, Auth, Users, isLogged) {\r\n  $scope.newUser = {}\r\n\r\n  if (isLogged) return $location.path('/channels')\r\n\r\n  $scope.login = function() {\r\n    Auth.$authWithPassword($scope.newUser)\r\n      .then(function(authData) {\r\n        Users.setOnline(authData.uid)\r\n        $location.path('/channels')\r\n      })\r\n      .catch(console.error)\r\n  }\r\n}\r\n","angular.module('FlameSlackApp')\r\n  .controller('MainCtrl', MainCtrl)\r\n\r\n\r\nfunction MainCtrl($scope, $rootScope, $location, Auth, Users, Usernames) {\r\n\r\n  Auth.$onAuth(function(authData) {\r\n    if (authData) {\r\n      $rootScope.user = Users.getProfile(authData.uid)\r\n      Users.setOnline(authData.uid)\r\n      $rootScope.isAdmin = Users.isAdmin(authData.uid)\r\n    } else {\r\n      $rootScope.user = null\r\n      $location.path('/login')\r\n    }\r\n  })  \r\n  \r\n  $scope.lightbox = function(src) {\r\n    $scope.lightboxSrc = src\r\n  }\r\n\r\n  $scope.logout = function() {\r\n    Users.setOffline($scope.user.$id)\r\n    Auth.$unauth()\r\n  }      \r\n}","angular.module('FlameSlackApp')\r\n  .controller('RegisterCtrl', RegisterCtrl)\r\n\r\n\r\nfunction RegisterCtrl($scope, $location, Auth, Users, usernames, isLogged) {\r\n  $scope.usernames = usernames\r\n  $scope.newUser = {}\r\n  \r\n  if (isLogged) return $location.path('/channels')\r\n\r\n  $scope.register = function() {\r\n    if ($scope.RegisterForm.$invalid) return\r\n    if ($scope.usernames[$scope.newUser.username])\r\n      return console.log('this username already exists')\r\n\r\n    Auth.$createUser($scope.newUser)\r\n      .then(function(authData) {\r\n        return Auth.$authWithPassword($scope.newUser)\r\n      })\r\n      .then(function(authData) {\r\n        Users.setOnline(authData.uid)\r\n        var profile = Users.getProfile(authData.uid)\r\n\r\n        $scope.usernames[$scope.newUser.username] = authData.uid\r\n        $scope.usernames.$save()\r\n        profile.username = $scope.newUser.username\r\n        profile.avatar = authData.password.profileImageURL\r\n        profile.$save()\r\n        Users.all.$save()\r\n        $location.path('/channels')\r\n      })\r\n  }\r\n}","angular.module('FlameSlackApp', [\r\n    'ngRoute', \r\n    'firebase', \r\n    'ui.bootstrap',\r\n    'ngSanitize'\r\n  ]) \r\n\r\n  .constant('FB', 'https://flame-slack.firebaseio.com/')\r\n\r\n  .config(function($routeProvider) {\r\n    $routeProvider\r\n      .when('/login', {\r\n        controller: 'LoginCtrl',\r\n        templateUrl: 'views/login.html',\r\n        resolve: {\r\n          isLogged: function(Auth) {\r\n            return Auth.$waitForAuth()\r\n          }\r\n        }\r\n      })\r\n      .when('/register', {\r\n        controller: 'RegisterCtrl',\r\n        templateUrl: 'views/register.html',\r\n        resolve: {\r\n          usernames: function(Usernames) {\r\n            return Usernames.$loaded()\r\n          },\r\n          isLogged: function(Auth) {\r\n            return Auth.$waitForAuth()\r\n          }\r\n        }\r\n      })\r\n      .when('/channels/:channel?', {\r\n        controller: 'ChannelCtrl',\r\n        templateUrl: 'views/chat.html',\r\n        resolve: {\r\n          channels: function(Channels) {\r\n            return Channels.$loaded()\r\n          },\r\n          isLogged: function(Auth) {\r\n            return Auth.$waitForAuth()\r\n          }\r\n        }\r\n      })\r\n      .when('/messages/:user', {\r\n        controller: 'DirectCtrl',\r\n        templateUrl: 'views/chat.html',\r\n        resolve: {\r\n          usernames: function(Usernames) {\r\n            return Usernames.$loaded()\r\n          },\r\n          isLogged: function(Auth) {\r\n            return Auth.$waitForAuth()\r\n          }\r\n        }\r\n      })\r\n  })\r\n","angular.module('FlameSlackApp')\r\n\r\n  .directive('ngAutoscroll', function() {\r\n    function link($scope, $el) {\r\n      var el = $el[0],\r\n          isScrolled = true,\r\n          scrolledPosition = 0,\r\n          fullscreenchange = 'webkitfullscreenchange mozfullscreenchange fullscreenchange'\r\n\r\n      function scrollToBottom() {\r\n        if (isScrolled) el.scrollTop = el.scrollHeight\r\n      }\r\n\r\n      $el.on('DOMSubtreeModified', scrollToBottom)\r\n\r\n      // chrome scroll fix\r\n      angular.element(document).on(fullscreenchange, function(e) {\r\n        if (e.target != document) {\r\n          scrolledPosition = e.target.parentElement.offsetTop\r\n        } else if (scrolledPosition) {\r\n          el.scrollTop = scrolledPosition\r\n        }\r\n      })\r\n\r\n      $el.on('scroll', function() {\r\n        isScrolled = el.scrollTop == el.scrollHeight - el.offsetHeight\r\n      })\r\n\r\n      $scope.$on('dividerTop', function(e, top) {\r\n        el.scrollTop = top\r\n      })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngFocus', function() {\r\n    function link($scope, $el) {\r\n      $el[0].focus()\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('divider', function() {\r\n    function link($scope, $el) {\r\n      angular.element(document.getElementById('chat'))\r\n        .one('DOMSubtreeModified', function() {\r\n          $scope.$emit('dividerTop', $el[0].offsetTop - 150)\r\n        })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngTabActive', function($window, $rootScope,  Title) {\r\n    function link() {\r\n      angular.element($window)\r\n        .on('focus', function() {\r\n          $rootScope.isTabActive = true\r\n          $rootScope.$broadcast('tab-active', true)\r\n        })\r\n        .on('blur', function() {\r\n          $rootScope.isTabActive = false\r\n          $rootScope.$broadcast('tab-active', false)\r\n        })\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('uniqueUsername', function() {\r\n    function link($scope, $el, $attrs, ngModel) {\r\n      ngModel.$validators.uniqueUsername = function(val) {\r\n        return !$scope.usernames.hasOwnProperty(val)\r\n      }\r\n    }\r\n\r\n    return {\r\n      require: 'ngModel',\r\n      link: link\r\n    }\r\n  })\r\n\r\n  .directive('ngEnter', function() {\r\n    function link($scope, $el) {\r\n      $el.on('input', function() {\r\n        $el.css('height', $el[0].scrollHeight + 2 + 'px')\r\n      })\r\n\r\n      $el.on('keydown', function(e) {\r\n        if (e.keyCode == 13 && !e.shiftKey) {\r\n          $scope.ngEnter()\r\n          $el.css('height', '34px')\r\n          e.preventDefault()\r\n        }\r\n      })\r\n    }\r\n\r\n    return {\r\n      scope: {\r\n        ngEnter: '&'\r\n      },\r\n      link: link\r\n    }\r\n  })","angular.module('FlameSlackApp')\r\n\r\n  .factory('Auth', function($firebaseAuth, FB) {\r\n    return $firebaseAuth(new Firebase(FB))\r\n  })\r\n\r\n  .factory('Users', function($firebaseArray, $firebaseObject, FB) {\r\n    var usersRef = new Firebase(FB + 'users'),\r\n        connectedRef = new Firebase(FB + '.info/connected'),\r\n        users = $firebaseArray(usersRef)\r\n\r\n    return {\r\n      getProfile: function(uid) {\r\n        return $firebaseObject(usersRef.child(uid))\r\n      },\r\n      setOnline: function(uid) {\r\n        var connected = $firebaseObject(connectedRef)\r\n            online = $firebaseArray(usersRef.child(uid + '/online'))\r\n\r\n        connected.$watch(function() {\r\n          if (connected.$value === true) {\r\n            online.$add(true).then(function() {\r\n              online.$ref().onDisconnect().remove()\r\n            })\r\n          }\r\n        })\r\n\r\n        usersRef.child(uid + '/lastOnline')\r\n          .onDisconnect().set(Firebase.ServerValue.TIMESTAMP)\r\n      },\r\n      setOffline: function(uid) {\r\n        usersRef.child(uid + '/online').remove()\r\n        usersRef.child(uid + '/lastOnline').set(Firebase.ServerValue.TIMESTAMP)\r\n      },\r\n      isAdmin: function(uid) {\r\n        return $firebaseObject(new Firebase(FB).child('admins').child(uid))\r\n      },\r\n      all: users\r\n    }\r\n  })\r\n\r\n  .factory('Usernames', function($firebaseObject, FB) {\r\n    return $firebaseObject(new Firebase(FB + 'usernames'))\r\n  })\r\n\r\n  .factory('Channels', function($firebaseObject, FB) {\r\n    return $firebaseObject(new Firebase(FB + 'channels'))\r\n  })\r\n\r\n  .factory('Messages', function($firebaseArray, FB) {\r\n    var msgRef = new Firebase(FB + 'messages')\r\n\r\n    return function(channel) {\r\n      return $firebaseArray(msgRef.child(channel))\r\n    }\r\n  })\r\n\r\n  .factory('Direct', function($firebaseArray, $firebaseObject, FB) {\r\n    return {\r\n      messages: function(uid1, uid2) {\r\n        var path = uid1 < uid2 ? uid1 + '/' + uid2 : uid2 + '/' + uid1\r\n        return $firebaseArray(new Firebase(FB).child('direct').child(path))\r\n      },\r\n      notify: function(from, to) {\r\n        var ref = new Firebase(FB + 'directNotification').child(to).child(from)\r\n        ref.transaction(function(val) {\r\n          return val ? val + 1 : 1\r\n        })\r\n      },\r\n      notifications: function(uid) {\r\n        return $firebaseObject(new Firebase(FB + 'directNotification').child(uid))\r\n      },\r\n      removeNotifications: function(to, from) {\r\n        new Firebase(FB + 'directNotification').child(to).child(from).remove()\r\n      }\r\n    }\r\n  })\r\n\r\n  .factory('Title', function($rootScope, FB) {\r\n    var Title = {\r\n      set: function(channel) {\r\n        $rootScope.title = channel + ' | Flame Slack'\r\n      },\r\n      add: function(s) {\r\n        if (!~$rootScope.title.indexOf(s))\r\n          $rootScope.title = s + $rootScope.title\r\n      },\r\n      remove: function(s) {\r\n        if (!s)\r\n          $rootScope.title = $rootScope.title.replace(/[\\!\\*] /g, '')\r\n        else if (~$rootScope.title.indexOf(s))\r\n          $rootScope.title = $rootScope.title.replace(s, '')\r\n      }\r\n    }\r\n\r\n    return Title\r\n  })","angular.module('FlameSlackApp')\r\n\r\n  .filter('code', function() {\r\n    return function(text) {\r\n      return text.replace(/```([^`]+)```/g, '<pre>$1</pre>')\r\n                 .replace(/`([^`]+)`/g, '<code>$1</code>')\r\n    }\r\n  })\r\n\r\n  .filter('quote', function() {\r\n    return function(text) {\r\n      return text.replace(/^>([^\\n]+)$\\n?/gm, '<blockquote>$1</blockquote>')\r\n    }\r\n  })\r\n\r\n  .filter('link', function($http) {\r\n    var linkRegExp = /(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})\\/([\\/\\w\\.\\-=?]*)*\\/?/gi\r\n    var imageRegExp = /\\.(jpg|jpeg|png|gif)/\r\n    var youtubeRegExp = /(https?:\\/\\/)(www\\.)?youtu\\.?be(\\.com)?\\/(watch\\?v=)?([\\w\\-_]+)(\\?t=)?(\\w+)?/i\r\n    var vimeoRegExp = /https?:\\/\\/vimeo\\.com\\/(\\d+)/i\r\n\r\n\r\n    return function(text, scope) {\r\n      return text.replace(linkRegExp, function(link, protocol) {\r\n        var html = '<a href=\"' + (protocol ? '' : 'http://') + \r\n                    link + '\" target=\"_blank\">' + link + '</a>'\r\n\r\n        if (imageRegExp.test(link) && !scope.image) \r\n          scope.image = {\r\n            src: link\r\n          }\r\n\r\n        if (youtubeRegExp.test(link) && !scope.youtube) \r\n          scope.youtube = {\r\n            id: link.match(youtubeRegExp)[5]\r\n          }\r\n\r\n        if (vimeoRegExp.test(link) && !scope.vimeo) {\r\n          var vimeoId = link.match(vimeoRegExp)[1]\r\n\r\n          scope.vimeo = {\r\n            id: vimeoId\r\n          }\r\n\r\n          $http\r\n            .jsonp('https://vimeo.com/api/v2/video/' + \r\n                    vimeoId + '.json?callback=JSON_CALLBACK')\r\n            .success(function(data) {\r\n              scope.vimeo.preview = data[0].thumbnail_large\r\n            })\r\n        }\r\n\r\n        return html\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('username', function($rootScope) {\r\n    return function(text) {\r\n      var users = $rootScope.users.map(function(user) {return user.username})\r\n\r\n      return text.replace(/@(\\w+)/, function(match, username) {\r\n        var currentUser = $rootScope.user.username == username\r\n\r\n        if (~users.indexOf(username)) {\r\n          if (currentUser) $rootScope.$broadcast('mention')\r\n\r\n          return '<a href=\"#/user/' + username + '\"' +\r\n                 (currentUser ? 'class=\"mention\"' : '') +\r\n                 '>' + match + '</a>'\r\n        } else {\r\n          return match\r\n        }\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('channel', function($rootScope) {\r\n    return function(text) {\r\n      return text.replace(/#(\\w+)/gi, function(match, channel) {\r\n        if ($rootScope.channels.hasOwnProperty(channel))\r\n          return '<a href=\"#/channels/' + channel + '\">' + match + '</a>'\r\n        else\r\n          return match\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('trustAsHtml', function($sce){\r\n    return $sce.trustAsHtml\r\n  })\r\n\r\n  .filter('trustAsResourceUrl', function($sce) {\r\n    return $sce.trustAsResourceUrl\r\n  })\r\n\r\n\r\n","function ChannelCtrl(e,n,t,r,i,a,o,s,l,c){return a?t.channel&&i.hasOwnProperty(t.channel)?(e.channels||(n.channels=i),e.users||(n.users=s.all),e.channel=t.channel,e.msg={},e.divider=e.user.lastReaded&&e.user.lastReaded[e.channel],l.set(e.channel),e.channels.$ref().on(\"child_added\",function(t){e.messages||(n.messages={}),e.messages[t.key()]=o(t.key())}),e.$watchCollection(\"messages.\"+e.channel,function(n){e.user.lastReaded=e.user.lastReaded||{},e.user.lastReaded[e.channel]=n.length&&n[n.length-1].$id,e.user.$save()}),new Firebase(c+\"messages/\").on(\"child_changed\",function(){e.isTabActive||l.add(\"* \")}),e.$on(\"mention\",function(){e.isTabActive||l.add(\"! \")}),e.$on(\"tab-active\",function(e,n){n&&l.remove()}),e.addMessage=function(){e.msg.text&&(e.msg.channel=e.channel,e.msg.timestamp=Firebase.ServerValue.TIMESTAMP,e.msg.author={id:e.user.$id,username:e.user.username,avatar:e.user.avatar},e.messages[e.channel].$add(e.msg),e.msg={})},e.remove=function(n){e.messages[e.channel].$remove(n)},void(e.createChannel=function(){e.newChannelForm.$invalid||(e.channels[e.newChannelName]=!0,e.channels.$save(),e.messages[e.newChannelName]=o(e.newChannelName),e.newChannelName=\"\",e.isNewChannelFormShowed=!1)})):r.path(\"channels/general\"):r.path(\"/login\")}function DirectCtrl(e,n,t,r,i,a,o,s,l,c){return a?(i.hasOwnProperty(t.user)||console.log(\"user not found\"),e.users||(n.users=s.all),e.channels||(n.channels=o),e.directNotify||(n.directNotify=l.notifications(e.user.$id)),e.msg={},e.directWith={$id:i[t.user],username:t.user},e.messages=l.messages(e.user.$id,e.directWith.$id),l.removeNotifications(e.user.$id,e.directWith.$id),void(e.addMessage=function(){e.msg.text&&(e.msg.timestamp=Firebase.ServerValue.TIMESTAMP,e.msg.author={id:e.user.$id,username:e.user.username,avatar:e.user.avatar},e.messages.$add(e.msg),l.notify(e.user.$id,e.directWith.$id),e.msg={})})):r.path(\"/login\")}function LoginCtrl(e,n,t,r,i){return e.newUser={},i?n.path(\"/channels\"):void(e.login=function(){t.$authWithPassword(e.newUser).then(function(e){r.setOnline(e.uid),n.path(\"/channels\")})[\"catch\"](console.error)})}function MainCtrl(e,n,t,r,i,a){r.$onAuth(function(e){e?(n.user=i.getProfile(e.uid),i.setOnline(e.uid),n.isAdmin=i.isAdmin(e.uid)):(n.user=null,t.path(\"/login\"))}),e.lightbox=function(n){e.lightboxSrc=n},e.logout=function(){i.setOffline(e.user.$id),r.$unauth()}}function RegisterCtrl(e,n,t,r,i,a){return e.usernames=i,e.newUser={},a?n.path(\"/channels\"):void(e.register=function(){return e.RegisterForm.$invalid?void 0:e.usernames[e.newUser.username]?console.log(\"this username already exists\"):void t.$createUser(e.newUser).then(function(n){return t.$authWithPassword(e.newUser)}).then(function(t){r.setOnline(t.uid);var i=r.getProfile(t.uid);e.usernames[e.newUser.username]=t.uid,e.usernames.$save(),i.username=e.newUser.username,i.avatar=t.password.profileImageURL,i.$save(),r.all.$save(),n.path(\"/channels\")})})}angular.module(\"FlameSlackApp\",[\"ngRoute\",\"firebase\",\"ui.bootstrap\",\"ngSanitize\"]).constant(\"FB\",\"https://flame-slack.firebaseio.com/\").config([\"$routeProvider\",function(e){e.when(\"/login\",{controller:\"LoginCtrl\",templateUrl:\"views/login.html\",resolve:{isLogged:[\"Auth\",function(e){return e.$waitForAuth()}]}}).when(\"/register\",{controller:\"RegisterCtrl\",templateUrl:\"views/register.html\",resolve:{usernames:[\"Usernames\",function(e){return e.$loaded()}],isLogged:[\"Auth\",function(e){return e.$waitForAuth()}]}}).when(\"/channels/:channel?\",{controller:\"ChannelCtrl\",templateUrl:\"views/chat.html\",resolve:{channels:[\"Channels\",function(e){return e.$loaded()}],isLogged:[\"Auth\",function(e){return e.$waitForAuth()}]}}).when(\"/messages/:user\",{controller:\"DirectCtrl\",templateUrl:\"views/chat.html\",resolve:{usernames:[\"Usernames\",function(e){return e.$loaded()}],isLogged:[\"Auth\",function(e){return e.$waitForAuth()}]}})}]),angular.module(\"FlameSlackApp\").directive(\"ngAutoscroll\",function(){function e(e,n){function t(){i&&(r.scrollTop=r.scrollHeight)}var r=n[0],i=!0,a=0,o=\"webkitfullscreenchange mozfullscreenchange fullscreenchange\";n.on(\"DOMSubtreeModified\",t),angular.element(document).on(o,function(e){e.target!=document?a=e.target.parentElement.offsetTop:a&&(r.scrollTop=a)}),n.on(\"scroll\",function(){i=r.scrollTop==r.scrollHeight-r.offsetHeight}),e.$on(\"dividerTop\",function(e,n){r.scrollTop=n})}return{link:e}}).directive(\"ngFocus\",function(){function e(e,n){n[0].focus()}return{link:e}}).directive(\"divider\",function(){function e(e,n){angular.element(document.getElementById(\"chat\")).one(\"DOMSubtreeModified\",function(){e.$emit(\"dividerTop\",n[0].offsetTop-150)})}return{link:e}}).directive(\"ngTabActive\",[\"$window\",\"$rootScope\",\"Title\",function(e,n,t){function r(){angular.element(e).on(\"focus\",function(){n.isTabActive=!0,n.$broadcast(\"tab-active\",!0)}).on(\"blur\",function(){n.isTabActive=!1,n.$broadcast(\"tab-active\",!1)})}return{link:r}}]).directive(\"uniqueUsername\",function(){function e(e,n,t,r){r.$validators.uniqueUsername=function(n){return!e.usernames.hasOwnProperty(n)}}return{require:\"ngModel\",link:e}}).directive(\"ngEnter\",function(){function e(e,n){n.on(\"input\",function(){n.css(\"height\",n[0].scrollHeight+2+\"px\")}),n.on(\"keydown\",function(t){13!=t.keyCode||t.shiftKey||(e.ngEnter(),n.css(\"height\",\"34px\"),t.preventDefault())})}return{scope:{ngEnter:\"&\"},link:e}}),angular.module(\"FlameSlackApp\").factory(\"Auth\",[\"$firebaseAuth\",\"FB\",function(e,n){return e(new Firebase(n))}]).factory(\"Users\",[\"$firebaseArray\",\"$firebaseObject\",\"FB\",function(e,n,t){var r=new Firebase(t+\"users\"),i=new Firebase(t+\".info/connected\"),a=e(r);return{getProfile:function(e){return n(r.child(e))},setOnline:function(t){var a=n(i);online=e(r.child(t+\"/online\")),a.$watch(function(){a.$value===!0&&online.$add(!0).then(function(){online.$ref().onDisconnect().remove()})}),r.child(t+\"/lastOnline\").onDisconnect().set(Firebase.ServerValue.TIMESTAMP)},setOffline:function(e){r.child(e+\"/online\").remove(),r.child(e+\"/lastOnline\").set(Firebase.ServerValue.TIMESTAMP)},isAdmin:function(e){return n(new Firebase(t).child(\"admins\").child(e))},all:a}}]).factory(\"Usernames\",[\"$firebaseObject\",\"FB\",function(e,n){return e(new Firebase(n+\"usernames\"))}]).factory(\"Channels\",[\"$firebaseObject\",\"FB\",function(e,n){return e(new Firebase(n+\"channels\"))}]).factory(\"Messages\",[\"$firebaseArray\",\"FB\",function(e,n){var t=new Firebase(n+\"messages\");return function(n){return e(t.child(n))}}]).factory(\"Direct\",[\"$firebaseArray\",\"$firebaseObject\",\"FB\",function(e,n,t){return{messages:function(n,r){var i=r>n?n+\"/\"+r:r+\"/\"+n;return e(new Firebase(t).child(\"direct\").child(i))},notify:function(e,n){var r=new Firebase(t+\"directNotification\").child(n).child(e);r.transaction(function(e){return e?e+1:1})},notifications:function(e){return n(new Firebase(t+\"directNotification\").child(e))},removeNotifications:function(e,n){new Firebase(t+\"directNotification\").child(e).child(n).remove()}}}]).factory(\"Title\",[\"$rootScope\",\"FB\",function(e,n){var t={set:function(n){e.title=n+\" | Flame Slack\"},add:function(n){~e.title.indexOf(n)||(e.title=n+e.title)},remove:function(n){n?~e.title.indexOf(n)&&(e.title=e.title.replace(n,\"\")):e.title=e.title.replace(/[\\!\\*] /g,\"\")}};return t}]),angular.module(\"FlameSlackApp\").filter(\"code\",function(){return function(e){return e.replace(/```([^`]+)```/g,\"<pre>$1</pre>\").replace(/`([^`]+)`/g,\"<code>$1</code>\")}}).filter(\"quote\",function(){return function(e){return e.replace(/^>([^\\n]+)$\\n?/gm,\"<blockquote>$1</blockquote>\")}}).filter(\"link\",[\"$http\",function(e){var n=/(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})\\/([\\/\\w\\.\\-=?]*)*\\/?/gi,t=/\\.(jpg|jpeg|png|gif)/,r=/(https?:\\/\\/)(www\\.)?youtu\\.?be(\\.com)?\\/(watch\\?v=)?([\\w\\-_]+)(\\?t=)?(\\w+)?/i,i=/https?:\\/\\/vimeo\\.com\\/(\\d+)/i;return function(a,o){return a.replace(n,function(n,a){var s='<a href=\"'+(a?\"\":\"http://\")+n+'\" target=\"_blank\">'+n+\"</a>\";if(t.test(n)&&!o.image&&(o.image={src:n}),r.test(n)&&!o.youtube&&(o.youtube={id:n.match(r)[5]}),i.test(n)&&!o.vimeo){var l=n.match(i)[1];o.vimeo={id:l},e.jsonp(\"https://vimeo.com/api/v2/video/\"+l+\".json?callback=JSON_CALLBACK\").success(function(e){o.vimeo.preview=e[0].thumbnail_large})}return s})}}]).filter(\"username\",[\"$rootScope\",function(e){return function(n){var t=e.users.map(function(e){return e.username});return n.replace(/@(\\w+)/,function(n,r){var i=e.user.username==r;return~t.indexOf(r)?(i&&e.$broadcast(\"mention\"),'<a href=\"#/user/'+r+'\"'+(i?'class=\"mention\"':\"\")+\">\"+n+\"</a>\"):n})}}]).filter(\"channel\",[\"$rootScope\",function(e){return function(n){return n.replace(/#(\\w+)/gi,function(n,t){return e.channels.hasOwnProperty(t)?'<a href=\"#/channels/'+t+'\">'+n+\"</a>\":n})}}]).filter(\"trustAsHtml\",[\"$sce\",function(e){return e.trustAsHtml}]).filter(\"trustAsResourceUrl\",[\"$sce\",function(e){return e.trustAsResourceUrl}]),angular.module(\"FlameSlackApp\").controller(\"ChannelCtrl\",ChannelCtrl),ChannelCtrl.$inject=[\"$scope\",\"$rootScope\",\"$routeParams\",\"$location\",\"channels\",\"isLogged\",\"Messages\",\"Users\",\"Title\",\"FB\"],angular.module(\"FlameSlackApp\").controller(\"DirectCtrl\",DirectCtrl),DirectCtrl.$inject=[\"$scope\",\"$rootScope\",\"$routeParams\",\"$location\",\"usernames\",\"isLogged\",\"Channels\",\"Users\",\"Direct\",\"FB\"],angular.module(\"FlameSlackApp\").controller(\"LoginCtrl\",LoginCtrl),LoginCtrl.$inject=[\"$scope\",\"$location\",\"Auth\",\"Users\",\"isLogged\"],angular.module(\"FlameSlackApp\").controller(\"MainCtrl\",MainCtrl),MainCtrl.$inject=[\"$scope\",\"$rootScope\",\"$location\",\"Auth\",\"Users\",\"Usernames\"],angular.module(\"FlameSlackApp\").controller(\"RegisterCtrl\",RegisterCtrl),RegisterCtrl.$inject=[\"$scope\",\"$location\",\"Auth\",\"Users\",\"usernames\",\"isLogged\"];\n//# sourceMappingURL=app.min.js.map\n"],"sourceRoot":"/source/"}